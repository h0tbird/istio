#!/bin/bash

function generate {
  istioctl-$1 manifest generate -r $1 \
    --component $2 \
    -s "components.pilot.k8s.overlays[0].name=istiod-${1}" \
    -f ./config/iop-base.yaml \
    -f ./config/iop-cni.yaml \
    -f ./config/iop-pilot.yaml \
    -f ./config/iop-igws.yaml \
    -f ./config/iop-ewgw.yaml |
  sed '
    s/cluster-XXXX/{{ .Values.cluster }}/g;
    s/network-XXXX/{{ .Values.network }}/g;
    s/mesh-XXXX/{{ .Values.mesh }}/g;
  '
}

[ $# -eq 2 ] && generate "$@"
